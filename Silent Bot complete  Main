     1 import os
     2 import sys
     3 import uuid
     4 import time
     5 from typing import List, Optional, Literal, Dict, Any
     6
     7 import requests
     8 from fastapi import FastAPI, Header, HTTPException, Request, Query
     9 from fastapi.middleware.cors import CORSMiddleware
    10 from fastapi.responses import HTMLResponse, PlainTextResponse
    11 # The 'rich' library can be used for a better CLI experience, but has been simplified
    12 # to ensure compatibility.
    13 # from rich.console import Console
    14 # from rich.prompt import Prompt
    15
    16 # ==========================
    17 # CONFIG
    18 # ==========================
    19
    20 load_dotenv()
    21
    22 OPENAI_API_KEY = os.getenv("OPENAI_API_KEY", "")
    23 OPENAI_BASE_URL = os.getenv("OPENAI_BASE_URL", "https://api.openai.com/v1")
    24 DEFAULT_MODEL = os.getenv("SILENTBOT_MODEL", "gpt-4o")
    25
    26 PRO_UNLOCK_CODE = os.getenv("PRO_UNLOCK_CODE", "MYSECRETPROCODE")
    27 ADMIN_LOG_CODE = os.getenv("ADMIN_LOG_CODE", "MRSILENT.ADMIN.LOG.VIEW.2025")
    28 JWT_SECRET_KEY = os.getenv("JWT_SECRET_KEY", "AnotherRandomSecretKey")
    29
    30 NORMAL_MAX_TOKENS = 512
    31 PRO_MAX_TOKENS = 2048
    32
    33 MAX_REQUESTS_PER_MINUTE_NORMAL = 20
    34 MAX_REQUESTS_PER_MINUTE_PRO = 120
    35
    36 LOG_DIR = "logs"
    37 CLI_CONFIG_FILE = "silentbot_cli_config.txt"
    38 PER_USER_MAX_LOG_BYTES = 512_000
    39
    40 if not OPENAI_API_KEY or OPENAI_API_KEY == "sk-...":
    41     print("WARNING: OPENAI_API_KEY is not set correctly. Please check your .env file.")
    42
    43 os.makedirs(LOG_DIR, exist_ok=True)
    44
    45 # ==========================
    46 # IN-MEMORY STATE (SERVER)
    47 # ==========================
    48
    49 class UserState(BaseModel):
    50     user_id: str
    51     is_pro: bool = False
    52     created_at: float = time.time()
    53     last_minute_window: int = 0
    54     requests_in_window: int = 0
    55
    56
    57 USERS: Dict[str, UserState] = {}
    58
    59 # ==========================
    60 # MODELS
    61 # ==========================
    62
    63 class ChatMessage(BaseModel):
    64     role: Literal["system", "user", "assistant"]
    65     content: str
    66
    67
    68 class ChatRequest(BaseModel):
    69     messages: List[ChatMessage]
    70     mode: Optional[Literal["auto", "normal", "pro"]] = "auto"
    71     temperature: float = 0.3
    72     max_tokens: Optional[int] = None
    73
    74
    75 class ChatResponse(BaseModel):
    76     user_id: str
    77     mode: Literal["normal", "pro"]
    78     model: str
    79     response: str
    80     tokens_used: Optional[int] = None
    81
    82
    83 class ActivateProRequest(BaseModel):
    84     code: str
    85
    86
    87 class ActivateProResponse(BaseModel):
    88     user_id: str
    89     is_pro: bool
    90     message: str
    91
    92
    93 class MeResponse(BaseModel):
    94     user_id: str
    95     is_pro: bool
    96     created_at: float
    97
    98 # ==========================
    99 # LOGGING
   100 # ==========================
   101
   102 def get_log_path(channel: str, user_id: Optional[str] = None) -> str:
   103     if user_id:
   104         name = f"{channel}_{user_id}.log"
   105     else:
   106         name = f"{channel}_general.log"
   107     return os.path.join(LOG_DIR, name)
   108
   109
   110 def rotate_if_needed(path: str):
   111     if not os.path.exists(path):
   112         return
   113     if os.path.getsize(path) > PER_USER_MAX_LOG_BYTES:
   114         ts = time.strftime("%Y%m%d_%H%M%S", time.localtime())
   115         rotated = f"{path}.{ts}.bak"
   116         os.rename(path, rotated)
   117
   118
   119 def log_event(channel: str, event_type: str, data: Dict[str, Any]):
   120     user_id = data.get("user_id")
   121     path = get_log_path(channel, user_id)
   122     rotate_if_needed(path)
   123     timestamp = time.strftime("%Y-%m-%d %H:%M:%S", time.localtime())
   124     line = f"[{timestamp}] {event_type} | " + " | ".join(
   125         f"{k}={repr(v)}" for k, v in data.items()
   126     )
   127     with open(path, "a", encoding="utf-8") as f:
   128         f.write(line + "\n")
   129
   130 # ==========================
   131 # FASTAPI APP
   132 # ==========================
   133
   134 app = FastAPI(
   135     title="Silent Bot All-in-One",
   136     description="Silent Bot backend + simple web UI + Pro mode + CLI in one file.",
   137     version="1.2.0"
   138 )
   139
   140 app.add_middleware(
   141     CORSMiddleware,
   142     allow_origins=["*"],
   143     allow_credentials=True,
   144     allow_methods=["*"],
   145     allow_headers=["*"],
   146 )
   147
   148 # ==========================
   149 # HELPERS (SERVER)
   150 # ==========================
   151
   152 def get_or_create_user(x_client_id: Optional[str]) -> UserState:
   153     if not x_client_id:
   154         user_id = str(uuid.uuid4())
   155     else:
   156         user_id = x_client_id
   157
   158     if user_id not in USERS:
   159         USERS[user_id] = UserState(user_id=user_id)
   160         log_event("web", "new_user", {"user_id": user_id})
   161     return USERS[user_id]
   162
   163
   164 def enforce_rate_limit(user: UserState, mode: Literal["normal", "pro"]):
   165     now = int(time.time())
   166     current_window = now // 60
   167     if user.last_minute_window != current_window:
   168         user.last_minute_window = current_window
   169         user.requests_in_window = 0
   170
   171     user.requests_in_window += 1
   172     limit = MAX_REQUESTS_PER_MINUTE_PRO if mode == "pro" else MAX_REQUESTS_PER_MINUTE_NORMAL
   173     if user.requests_in_window > limit:
   174         log_event("web", "rate_limit", {"user_id": user.user_id, "mode": mode})
   175         raise HTTPException(status_code=429, detail=mode.capitalize() + " rate limit exceeded.")
   176
   177
   178 def determine_mode(requested_mode: str, user: UserState) -> Literal["normal", "pro"]:
   179     if requested_mode == "pro":
   180         if not user.is_pro:
   181             log_event("web", "pro_forbidden", {"user_id": user.user_id})
   182             raise HTTPException(status_code=403, detail="Pro mode not activated for this user.")
   183         return "pro"
   184     elif requested_mode == "normal":
   185         return "normal"
   186     else:
   187         return "pro" if user.is_pro else "normal"
   188
   189
   190 def build_system_prompt(mode: Literal["normal", "pro"]) -> str:
   191     base_prompt = (
   192         "You are Silent Bot, an efficient, security-focused AI assistant for SilentBot.online. "
   193         "You respond concisely with high technical accuracy. "
   194         "You always warn clearly about potential risks before suggesting system changes. "
   195         "You prioritize clarity, reversibility, and safety. "
   196     )
   197     if mode == "pro":
   198         pro_addition = (
   199             "You are currently in PRO PRODUCTION MODE. "
   200             "You can go deeper into architecture, automation, and advanced reasoning. "
   201             "You may provide more detailed and structured answers, with step-by-step breakdowns, "
   202             "while remaining practical and focused on implementation. "
   203         )
   204         return base_prompt + pro_addition
   205     normal_addition = (
   206         "You are currently in NORMAL MODE. "
   207         "Keep answers focused and reasonably short while still useful. "
   208     )
   209     return base_prompt + normal_addition
   210
   211
   212 def call_openai_chat_api(messages: List[Dict[str, Any]], max_tokens: int, temperature: float) -> Dict[str, Any]:
   213     url = f"{OPENAI_BASE_URL}/chat/completions"
   214     headers = {
   215         "Authorization": f"Bearer {OPENAI_API_KEY}",
   216         "Content-Type": "application/json"
   217     }
   218     payload = {
   219         "model": DEFAULT_MODEL,
   220         "messages": messages,
   221         "max_tokens": max_tokens,
   222         "temperature": temperature
   223     }
   224     resp = requests.post(url, json=payload, headers=headers, timeout=60)
   225     if resp.status_code != 200:
   226         log_event("web", "openai_error", {"status": resp.status_code, "body": resp.text[:400]})
   227         raise HTTPException(status_code=500, detail="Upstream model error: " + resp.text)
   228     return resp.json()
   229
   230 # ==========================
   231 # API ROUTES
   232 # ==========================
   233
   234 @app.post("/chat", response_model=ChatResponse)
   235 def chat_endpoint(
   236     chat_req: ChatRequest,
   237     x_client_id: Optional[str] = Header(default=None)
   238 ):
   239     user = get_or_create_user(x_client_id)
   240     mode = determine_mode(chat_req.mode or "auto", user)
   241     enforce_rate_limit(user, mode)
   242
   243     requested_max = chat_req.max_tokens
   244     if mode == "pro":
   245         max_tokens = min(requested_max or PRO_MAX_TOKENS, PRO_MAX_TOKENS)
   246     else:
   247         max_tokens = min(requested_max or NORMAL_MAX_TOKENS, NORMAL_MAX_TOKENS)
   248
   249     system_content = build_system_prompt(mode)
   250     messages = [{"role": "system", "content": system_content}]
   251     for m in chat_req.messages:
   252         messages.append({"role": m.role, "content": m.content})
   253
   254     start_time = time.time()
   255     raw = call_openai_chat_api(messages, max_tokens=max_tokens, temperature=chat_req.temperature)
   256     duration = time.time() - start_time
   257
   258     content = raw["choices"][0]["message"]["content"]
   259     tokens_used = raw.get("usage", {}).get("total_tokens")
   260
   261     log_event("web", "chat", {
   262         "user_id": user.user_id,
   263         "mode": mode,
   264         "tokens_used": tokens_used,
   265         "duration_sec": round(duration, 3)
   266     })
   267
   268     return ChatResponse(
   269         user_id=user.user_id,
   270         mode=mode,
   271         model=DEFAULT_MODEL,
   272         response=content,
   273         tokens_used=tokens_used
   274     )
   275
   276
   277 @app.post("/activate_pro", response_model=ActivateProResponse)
   278 def activate_pro(
   279     req: ActivateProRequest,
   280     x_client_id: Optional[str] = Header(default=None)
   281 ):
   282     user = get_or_create_user(x_client_id)
   283     if req.code.strip() != PRO_UNLOCK_CODE:
   284         log_event("web", "pro_invalid_code", {"user_id": user.user_id})
   285         raise HTTPException(status_code=403, detail="Invalid Pro code.")
   286     user.is_pro = True
   287     log_event("web", "pro_activated", {"user_id": user.user_id})
   288     return ActivateProResponse(
   289         user_id=user.user_id,
   290         is_pro=True,
   291         message="Pro Production Mode activated for this user."
   292     )
   293
   294
   295 @app.get("/me", response_model=MeResponse)
   296 def me(
   297     x_client_id: Optional[str] = Header(default=None)
   298 ):
   299     user = get_or_create_user(x_client_id)
   300     return MeResponse(
   301         user_id=user.user_id,
   302         is_pro=user.is_pro,
   303         created_at=user.created_at
   304     )
   305
   306
   307 @app.get("/admin/logs", response_class=PlainTextResponse)
   308 def admin_logs(
   309     code: str = Query(..., description="Admin log access code"),
   310     channel: str = Query("web", description="Log channel: web or cli"),
   311     user_id: Optional[str] = Query(None, description="Optional user_id to view per-user logs")
   312 ):
   313     if code != ADMIN_LOG_CODE:
   314         raise HTTPException(status_code=403, detail="Invalid admin log code.")
   315     if channel not in ("web", "cli"):
   316         raise HTTPException(status_code=400, detail="Invalid channel.")
   317     path = get_log_path(channel, user_id)
   318     if not os.path.exists(path):
   319         return "No logs found for channel=" + channel + ", user_id=" + (user_id or "general") + "."
   320     try:
   321         with open(path, "r", encoding="utf-8") as f:
   322             content = f.read()
   323     except Exception as e:
   324         raise HTTPException(status_code=500, detail="Error reading log file: " + str(e))
   325     return content or "(Log file is empty)"
   326
   327 # ==========================
   328 # SIMPLE WEB UI ("/")
   329 # ==========================
   330
   331 HTML_TEMPLATE = """
   332 <!DOCTYPE html>
   333 <html lang="en">
   334 <head>
   335   <meta charset="UTF-8" />
   336   <title>Silent Bot</title>
   337   <style>
   338     body {
   339       background: radial-gradient(circle at top, #141e30, #0a0f1a);
   340       color: #f5f5f5;
   341       font-family: "Consolas", "Fira Code", monospace;
   342       display: flex;
   343       flex-direction: column;
   344       align-items: center;
   345       padding: 20px;
   346     }
   347     .banner {
   348       white-space: pre;
   349       font-size: 10px;
   350       color: #00e5ff;
   351       text-align: center;
   352       margin-bottom: 10px;
   353     }
   354     .badge {
   355       padding: 4px 12px;
   356       border-radius: 999px;
   357       font-size: 12px;
   358       display: inline-block;
   359       margin-bottom: 10px;
   360       margin-right: 6px;
   361     }
   362     .badge-normal {
   363       background: #444;
   364       color: #fff;
   365     }
   366     .badge-pro {
   367       background: #00c853;
   368       color: #000;
   369       font-weight: bold;
   370     }
   371     .badge-locked {
   372       background: #b71c1c;
   373       color: #fff;
   374     }
   375     .card {
   376       background: rgba(15, 23, 42, 0.95);
   377       border-radius: 12px;
   378       padding: 16px;
   379       max-width: 900px;
   380       width: 100%;
   381       box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
   382       margin-bottom: 16px;
   383       border: 1px solid #1f2937;
   384     }
   385     .label {
   386       font-size: 12px;
   387       color: #9ca3af;
   388       margin-bottom: 4px;
   389       text-transform: uppercase;
   390       letter-spacing: 1px;
   391     }
   392     .value {
   393       font-size: 14px;
   394       color: #e5e7eb;
   395       word-break: break-all;
   396     }
   397     textarea {
   398       width: 100%;
   399       min-height: 80px;
   400       background: #020617;
   401       color: #e5e7eb;
   402       border-radius: 8px;
   403       border: 1px solid #1e293b;
   404       padding: 8px;
   405       font-family: inherit;
   406       resize: vertical;
   407     }
   408     .output {
   409       max-height: 260px;
   410       overflow-y: auto;
   411       background: #020617;
   412       border-radius: 8px;
   413       border: 1px solid #1e293b;
   414       padding: 8px;
   415       font-size: 14px;
   416       white-space: pre-wrap;
   417       margin-top: 8px;
   418     }
   419     button {
   420       background: linear-gradient(90deg, #00e5ff, #00c853);
   421       border: none;
   422       color: #000;
   423       padding: 8px 16px;
   424       margin-top: 8px;
   425       border-radius: 999px;
   426       font-weight: bold;
   427       cursor: pointer;
   428     }
   429     button.secondary {
   430       background: #111827;
   431       color: #f9fafb;
   432       border: 1px solid #374151;
   433     }
   434     .small {
   435       font-size: 11px;
   436       color: #9ca3af;
   437       margin-top: 4px;
   438     }
   439     input {
   440       width: 100%;
   441       padding: 8px;
   442       border-radius: 8px;
   443       border: 1px solid #1e293b;
   444       background: #020617;
   445       color: #e5e7eb;
   446       font-family: inherit;
   447     }
   448   </style>
   449 </head>
   450 <body>
   451   <div class="banner">
   452 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
   453 â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â•šâ•â•â–ˆâ–ˆâ•”â•â•â•
   454 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘
   455 â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘
   456 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘
   457 â•šâ•â•â•â•â•â•â•â•šâ•â•â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•â•   â•šâ•â•
   458                  SILENT BOT
   459   </div>
   460
   461   <div id="modeBadge" class="badge badge-normal">NORMAL MODE</div>
   462   <div id="proBadge" class="badge badge-locked">PRO PRODUCTION MODE LOCKED</div>
   463
   464   <div class="card">
   465     <div class="label">User ID</div>
   466     <div class="value" id="userId">loading...</div>
   467     <div class="label" style="margin-top:12px;">Pro Status</div>
   468     <div class="value" id="proStatus">loading...</div>
   469   </div>
   470
   471   <div class="card">
   472     <div class="label">Chat with Silent Bot</div>
   473     <textarea id="inputMessage" placeholder="Type your message..."></textarea>
   474     <button id="sendBtn">Send</button>
   475     <div class="output" id="outputArea"></div>
   476   </div>
   477
   478   <div class="card">
   479     <div class="label">Pro Production Mode</div>
   480     <input id="proCode" type="text" placeholder="Enter Pro Code" />
   481     <button class="secondary" id="unlockBtn">Unlock Pro</button>
   482     <div class="small" id="unlockResult" style="margin-top:4px;"></div>
   483   </div>
   484
   485   <script>
   486     const API_URL = window.location.origin;
   487
   488     function getClientId() {
   489       let id = localStorage.getItem("silentbotClientId");
   490       if (!id) {
   491         id = crypto.randomUUID();
   492         localStorage.setItem("silentbotClientId", id);
   493       }
   494       return id;
   495     }
   496
   497     const clientId = getClientId();
   498
   499     async function fetchMe() {
   500       const res = await fetch(API_URL + "/me", {
   501         headers: { "X-Client-Id": clientId }
   502       });
   503       const data = await res.json();
   504       updateStatusUI(data);
   505     }
   506
   507     function updateStatusUI(data) {
   508       document.getElementById("userId").textContent = data.user_id;
   509       const proStatus = data.is_pro ? "Unlocked âœ…" : "Locked ğŸ”’";
   510       document.getElementById("proStatus").textContent = proStatus;
   511
   512       const modeBadge = document.getElementById("modeBadge");
   513       const proBadge = document.getElementById("proBadge");
   514
   515       if (data.is_pro) {
   516         modeBadge.textContent = "PRO PRODUCTION MODE âœ…";
   517         modeBadge.className = "badge badge-pro";
   518         proBadge.textContent = "PRO MODE ACTIVE";
   519         proBadge.className = "badge badge-pro";
   520       } else {
   521         modeBadge.textContent = "NORMAL MODE";
   522         modeBadge.className = "badge badge-normal";
   523         proBadge.textContent = "PRO PRODUCTION MODE LOCKED";
   524         proBadge.className = "badge badge-locked";
   525       }
   526     }
   527
   528     async function sendMessage() {
   529       const input = document.getElementById("inputMessage");
   530       const output = document.getElementById("outputArea");
   531       const text = input.value.trim();
   532       if (!text) return;
   533
   534       output.textContent += "> " + text + "\\n\\n";
   535       input.value = "";
   536
   537       const res = await fetch(API_URL + "/chat", {
   538         method: "POST",
   539         headers: {
   540           "Content-Type": "application/json",
   541           "X-Client-Id": clientId
   542         },
   543         body: JSON.stringify({
   544           mode: "auto",
   545           messages: [{ role: "user", content: text }]
   546         })
   547       });
   548
   549       if (!res.ok) {
   550         output.textContent += "[Error talking to Silent Bot]\\n\\n";
   551         return;
   552       }
   553
   554       const data = await res.json();
   555       output.textContent += "Silent Bot:\\n" + data.response + "\\n\\n";
   556       output.scrollTop = output.scrollHeight;
   557     }
   558
   559     async function unlockPro() {
   560       const codeInput = document.getElementById("proCode");
   561       const result = document.getElementById("unlockResult");
   562       const code = codeInput.value.trim();
   563       if (!code) return;
   564
   565       const res = await fetch(API_URL + "/activate_pro", {
   566         method: "POST",
   567         headers: {
   568           "Content-Type": "application/json",
   569           "X-Client-Id": clientId
   570         },
   571         body: JSON.stringify({ code })
   572       });
   573
   574       if (!res.ok) {
   575         result.textContent = "Invalid code or error.";
   576         result.style.color = "#f87171";
   577         return;
   578       }
   579
   580       result.textContent = "Pro Mode Activated!";
   581       result.style.color = "#4ade80";
   582       fetchMe();
   583     }
   584
   585     document.getElementById("sendBtn").addEventListener("click", sendMessage);
   586     document.getElementById("unlockBtn").addEventListener("click", unlockPro);
   587     fetchMe();
   588   </script>
   589 </body>
   590 </html>
   591 """
   592
   593 @app.get("/", response_class=HTMLResponse)
   594 async def root(request: Request):
   595     return HTML_TEMPLATE
   596
   597 # ==========================
   598 # CLI MODE (same codebase)
   599 # ==========================
   600
   601 def load_cli_user():
   602     if not os.path.exists(CLI_CONFIG_FILE):
   603         user_id = str(uuid.uuid4())
   604         save_cli_user(user_id, False)
   605         return user_id, False
   606     with open(CLI_CONFIG_FILE, "r", encoding="utf-8") as f:
   607         lines = f.read().splitlines()
   608         user_id = lines[0]
   609         is_pro = len(lines) > 1 and lines[1].strip().lower() == "true"
   610         return user_id, is_pro
   611
   612
   613 def save_cli_user(user_id: str, is_pro: bool):
   614     with open(CLI_CONFIG_FILE, "w", encoding="utf-8") as f:
   615         f.write(user_id + "\n")
   616         f.write("true" if is_pro else "false")
   617
   618
   619 def cli_call_chat(user_id: str, is_pro: bool, message: str) -> str:
   620     mode = "pro" if is_pro else "normal"
   621     system_content = build_system_prompt("pro" if is_pro else "normal")
   622     full_messages = [{"role": "system", "content": system_content}, {"role": "user", "content": message}]
   623     start_time = time.time()
   624     raw = call_openai_chat_api(full_messages, max_tokens=PRO_MAX_TOKENS if is_pro else NORMAL_MAX_TOKENS,
       temperature=0.3)
   625     duration = time.time() - start_time
   626     content = raw["choices"][0]["message"]["content"]
   627     tokens_used = raw.get("usage", {}).get("total_tokens")
   628     log_event("cli", "chat", {
   629         "user_id": user_id,
   630         "mode": mode,
   631         "tokens_used": tokens_used,
   632         "duration_sec": round(duration, 3)
   633     })
   634     return content
   635
   636
   637 def cli_activate_pro(user_id: str) -> bool:
   638     code = input("Enter Pro Activation Code: ")
   639     if code.strip() != PRO_UNLOCK_CODE:
   640         print("Invalid Pro Code")
   641         log_event("cli", "pro_invalid_code", {"user_id": user_id})
   642         return False
   643     print("Pro Mode Activated (CLI)")
   644     log_event("cli", "pro_activated", {"user_id": user_id})
   645     return True
   646
   647
   648 def cli_banner(is_pro: bool):
   649     art = """
   650 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
   651 â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â•šâ•â•â–ˆâ–ˆâ•”â•â•â•
   652 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘
   653 â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘
   654 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘
   655 â•šâ•â•â•â•â•â•â•â•šâ•â•â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•â•   â•šâ•â•
   656                  SILENT BOT CLI
   657 """
   658     mode_text = "PRO PRODUCTION MODE" if is_pro else "NORMAL MODE"
   659     print(art)
   660     print(mode_text)
   661
   662
   663 def run_cli():
   664     user_id, is_pro = load_cli_user()
   665     cli_banner(is_pro)
   666     print("User ID: " + user_id)
   667     print("Commands: chat / unlock / exit\n")
   668     while True:
   669         cmd = input("Command: ").strip().lower()
   670         if cmd == "exit":
   671             break
   672         elif cmd == "unlock":
   673             if cli_activate_pro(user_id):
   674                 is_pro = True
   675                 save_cli_user(user_id, is_pro)
   676                 cli_banner(is_pro)
   677         elif cmd == "chat":
   678             while True:
   679                 msg = input("You: ").strip()
   680                 if msg.lower() in ("exit", "back", "quit"):
   681                     break
   682                 if not msg:
   683                     continue
   684                 reply = cli_call_chat(user_id, is_pro, msg)
   685                 print("Silent Bot:\n" + reply)
   686         else:
   687             print("Unknown command")
   688
   689 # ==========================
   690 # ENTRY POINT
   691 # ==========================
   692
   693 if __name__ == "__main__":
   694     if "--cli" in sys.argv:
   695         run_cli()
   696     else:
   697         import uvicorn
   698         # Note: The 'uvicorn.run' string should point to the name of this file.
   699         # If you rename this file, you must update the string below.
   700         uvicorn.run("fixed_silentbot:app", host="0.0.0.0", port=8000, reload=False)
